@import url('https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;700;800&family=Zen+Kaku+Gothic+New:wght@400;500;700&family=Playfair+Display:wght@400;600;700&display=swap');

*{margin:0;padding:0;box-sizing:border-box}
:root{
  --cream:#F5F0E8;--ink:#2C2416;--vermillion:#C23B22;--gold:#B8860B;
  --moss:#6B7F3B;--earth:#A0522D;--paper:#FAF7F2;
}
body{
  font-family:'Zen Kaku Gothic New',sans-serif;
  background:var(--cream);color:var(--ink);
  min-height:100vh;overflow-x:hidden;
  background-image:
    repeating-linear-gradient(0deg,transparent,transparent 39px,rgba(194,59,34,0.03) 39px,rgba(194,59,34,0.03) 40px),
    repeating-linear-gradient(90deg,transparent,transparent 39px,rgba(194,59,34,0.02) 39px,rgba(194,59,34,0.02) 40px);
}
body::after{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
}
#root{min-height:100vh;display:flex;flex-direction:column;position:relative;z-index:1}

/* ── Top Bar ── */
.top-bar{
  display:flex;justify-content:space-between;align-items:center;
  padding:0.8rem 1.5rem;
  background:rgba(250,247,242,0.85);backdrop-filter:blur(6px);
  border-bottom:2px solid rgba(194,59,34,0.15);
  position:sticky;top:0;z-index:10;
}
.season-badge{
  font-family:'Shippori Mincho',serif;font-size:1.8rem;font-weight:800;
  color:var(--vermillion);
  width:3rem;height:3rem;display:flex;align-items:center;justify-content:center;
  border:2px solid var(--vermillion);border-radius:4px;
  background:rgba(194,59,34,0.05);
}
.stats{display:flex;gap:1.5rem;align-items:center}
.stat{text-align:center}
.stat-label{font-size:0.65rem;text-transform:uppercase;letter-spacing:0.08em;color:#888}
.stat-val{font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:700;color:var(--gold)}
.stat-val.streak-val{color:var(--moss)}
.gear-btn{
  background:none;border:none;font-size:1.4rem;cursor:pointer;
  color:var(--ink);opacity:0.5;transition:opacity 0.2s;
}
.gear-btn:hover{opacity:1}

/* ── Main ── */
.main{flex:1;display:flex;flex-direction:column;align-items:center;padding:0.5rem 1rem 2rem}

/* ── Tree (bottom) ── */
.tree-section{
  width:100%;padding:1rem 0 0;margin-top:auto;
}
.tree-wrap{max-width:260px;margin:0 auto;text-align:center}
.tree-info{font-family:'Playfair Display',serif;font-size:0.75rem;color:#888;margin-bottom:0.2rem}
.tree-svg{width:100%;max-width:240px;height:auto}
.leaf-counter{font-family:'Playfair Display',serif;font-size:0.75rem;color:var(--gold);margin-top:0.1rem;font-weight:600}

/* ── Nobori Banner ── */
.nobori{
  position:relative;z-index:4;
  width:100%;max-width:380px;
  clip-path:polygon(0 0, 100% 0, 100% 86%, 50% 100%, 0 86%);
  filter:drop-shadow(2px 3px 10px rgba(0,0,0,0.1));
  background:var(--paper);
  transition:background-color 0.8s ease;
  margin:0.5rem auto 0;
}
.nobori-rod{
  height:5px;
  background:linear-gradient(90deg,#6B5B3D,var(--vermillion),#6B5B3D);
  opacity:0.7;
}
.nobori-content{
  padding:1rem 1.2rem 5.5rem;
  min-height:280px;
  display:flex;flex-direction:column;align-items:center;
}
.nobori::after{
  content:'';position:absolute;inset:0;
  background:repeating-linear-gradient(
    0deg,transparent,transparent 3px,rgba(0,0,0,0.008) 3px,rgba(0,0,0,0.008) 4px
  );
  pointer-events:none;
}
@keyframes noboriFlash{
  0%{filter:drop-shadow(2px 3px 10px rgba(0,0,0,0.1)) brightness(1)}
  40%{filter:drop-shadow(2px 3px 20px rgba(0,0,0,0.2)) brightness(1.08)}
  100%{filter:drop-shadow(2px 3px 10px rgba(0,0,0,0.1)) brightness(1)}
}
.nobori.flash{animation:noboriFlash 0.8s ease-out}

/* ── Welcome ── */
.welcome{text-align:center;animation:fadeUp 0.5s ease-out}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.app-title{
  font-family:'Shippori Mincho',serif;font-size:2.8rem;font-weight:800;
  color:var(--ink);margin-bottom:0.2rem;
}
.app-sub{font-size:0.9rem;color:#888;margin-bottom:1.5rem;font-style:italic}
.welcome-stats{font-size:0.85rem;color:#777;margin-bottom:1.5rem;line-height:1.8}
.btn-begin{
  font-family:'Zen Kaku Gothic New',sans-serif;font-size:1rem;font-weight:700;
  padding:0.8rem 2.5rem;color:var(--paper);
  background:linear-gradient(135deg,var(--vermillion),#9E2A1B);
  border:none;border-radius:6px;cursor:pointer;
  box-shadow:0 3px 10px rgba(194,59,34,0.3);
  transition:transform 0.15s,box-shadow 0.15s;
}
.btn-begin:hover{transform:translateY(-2px);box-shadow:0 5px 14px rgba(194,59,34,0.4)}
.btn-begin:active{transform:translateY(0)}

/* ── Word Display ── */
.word-card{text-align:center;margin-bottom:0.8rem;animation:fadeUp 0.4s ease-out}
.word-hira{font-family:'Shippori Mincho',serif;font-size:2.6rem;font-weight:800}
.word-kanji{font-family:'Shippori Mincho',serif;font-size:1.2rem;color:#777;margin-top:0.15rem}
.word-eng{font-size:0.85rem;color:#999;font-style:italic;margin-top:0.35rem;max-width:280px}
.mode-badge{
  display:inline-block;margin-top:0.4rem;
  padding:0.15rem 0.6rem;border-radius:20px;
  font-size:0.6rem;font-weight:600;
  border:1px solid rgba(80,75,65,0.3);color:#504b41;
  background:rgba(80,75,65,0.06);
}

/* ── Wheel (rotating, overlaps nobori) ── */
.wheel-section{
  display:flex;flex-direction:column;align-items:center;
  margin-top:-6.5rem;
  position:relative;z-index:6;
  animation:fadeUp 0.3s ease-out;
}
.wheel-svg{width:220px;height:220px;overflow:visible}
.wheel-confirm{
  margin-bottom:-0.7rem;position:relative;z-index:2;
  padding:0.25rem 0.8rem;
  font-family:'Zen Kaku Gothic New',sans-serif;
  font-weight:700;font-size:0.65rem;letter-spacing:0.04em;
  color:#3a3226;
  background:linear-gradient(180deg,#f5f0e6 0%,#e2d9c8 50%,#d4cab6 100%);
  border:1px solid #b0a48e;
  border-radius:10px;
  box-shadow:0 1px 0 #fff inset,0 -1px 0 rgba(0,0,0,0.08) inset,0 2px 4px rgba(0,0,0,0.12);
  cursor:pointer;
  transition:all 0.12s ease;
  text-shadow:0 1px 0 rgba(255,255,255,0.6);
}
.wheel-confirm:hover{
  background:linear-gradient(180deg,#faf7f0 0%,#e8dfce 50%,#d9cfba 100%);
  box-shadow:0 1px 0 #fff inset,0 -1px 0 rgba(0,0,0,0.08) inset,0 3px 6px rgba(0,0,0,0.15);
}
.wheel-confirm:active{
  background:linear-gradient(180deg,#d4cab6 0%,#e2d9c8 100%);
  box-shadow:0 -1px 0 #fff inset,0 1px 0 rgba(0,0,0,0.1) inset,0 1px 2px rgba(0,0,0,0.1);
  transform:translateY(1px);
}
.wheel-confirm:disabled{opacity:0.4;cursor:default;transform:none;box-shadow:0 1px 0 #fff inset,0 2px 4px rgba(0,0,0,0.08)}
@keyframes wheelOk{
  0%{filter:drop-shadow(0 0 0 rgba(107,127,59,0.6))}
  50%{filter:drop-shadow(0 0 16px rgba(107,127,59,0.9))}
  100%{filter:drop-shadow(0 0 0 rgba(107,127,59,0))}
}
@keyframes shakeX{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
.wheel-section.ok .wheel-svg{animation:wheelOk 0.6s ease-out}
.wheel-section.no{animation:shakeX 0.35s}

/* ── Grid ── */
.grid-area{width:100%;max-width:340px;margin:0 auto;animation:fadeUp 0.35s ease-out}
.conj-grid{
  display:grid;grid-template-columns:1fr 1fr;gap:0.5rem;
  padding:0.7rem;margin-bottom:0.8rem;
  border:2px solid rgba(194,59,34,0.2);border-radius:6px;
  background:rgba(255,255,255,0.5);
  position:relative;
}
.conj-grid::before,.conj-grid::after{
  content:'';position:absolute;background:var(--vermillion);opacity:0.15;
}
.conj-grid::before{width:2px;height:80%;top:10%;left:50%;transform:translateX(-1px)}
.conj-grid::after{height:2px;width:85%;left:7.5%;top:50%;transform:translateY(-1px)}
.gcell{display:flex;flex-direction:column;gap:0.1rem}
.ginput{
  font-family:'Shippori Mincho',serif;font-size:0.9rem;
  padding:0.4rem 0.35rem;text-align:center;
  border:1.5px solid rgba(184,134,11,0.4);border-radius:3px;
  background:rgba(255,255,255,0.7);color:var(--ink);
  transition:border-color 0.2s,background 0.2s,box-shadow 0.2s;
  width:100%;box-sizing:border-box;
}
.ginput::placeholder{font-family:'Zen Kaku Gothic New',sans-serif;font-size:0.65rem;color:#bbb;font-style:normal;letter-spacing:0.02em}
.ginput:focus{outline:none;border-color:var(--vermillion);box-shadow:0 0 0 3px rgba(194,59,34,0.1)}
.ginput.ok{border-color:var(--moss);background:rgba(107,127,59,0.08);color:var(--moss)}
.ginput.err{border-color:var(--earth);background:rgba(160,82,45,0.06);animation:shakeX 0.35s}
.ginput.shown{
  border-color:var(--gold);background:rgba(184,134,11,0.06);
  color:var(--gold);font-style:italic;
}
@keyframes greenFlash{
  0%{background:rgba(107,127,59,0.45);box-shadow:0 0 12px rgba(107,127,59,0.5)}
  100%{background:rgba(107,127,59,0.08);box-shadow:none}
}
.ginput.flash-ok{animation:greenFlash 0.6s ease-out}
.gcell-hint{font-size:0.6rem;min-height:0.7rem;color:#999}
.gcell-hint.red{color:var(--earth);font-weight:600}
.gcell-hint.green{color:var(--moss);font-weight:600}
.btn-submit{
  width:100%;padding:0.6rem;font-weight:700;font-size:0.9rem;
  background:linear-gradient(135deg,var(--vermillion),#9E2A1B);
  color:var(--paper);border:none;border-radius:4px;cursor:pointer;
  transition:transform 0.15s,box-shadow 0.15s;
  font-family:'Zen Kaku Gothic New',sans-serif;
}
.btn-submit:hover{transform:translateY(-1px);box-shadow:0 3px 8px rgba(194,59,34,0.3)}
.btn-submit:disabled{opacity:0.5;cursor:default;transform:none;box-shadow:none}
.btn-next{
  width:100%;padding:0.6rem;font-weight:700;font-size:0.9rem;
  background:var(--moss);color:var(--paper);
  border:none;border-radius:4px;cursor:pointer;margin-top:0.4rem;
  font-family:'Zen Kaku Gothic New',sans-serif;
  transition:transform 0.15s;
}
.btn-next:hover{transform:translateY(-1px)}

/* ── Result banner ── */
.result-banner{
  text-align:center;padding:0.6rem;margin-bottom:0.6rem;
  border-radius:6px;font-weight:700;font-size:0.9rem;animation:fadeUp 0.3s ease-out;
}
.result-banner.perfect{background:rgba(107,127,59,0.12);color:var(--moss);border:1.5px solid rgba(107,127,59,0.3)}
.result-banner.good{background:rgba(184,134,11,0.1);color:var(--gold);border:1.5px solid rgba(184,134,11,0.25)}

/* ── Modal ── */
.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.35);
  display:flex;align-items:center;justify-content:center;
  z-index:100;animation:fadeUp 0.2s ease-out;
}
.modal{
  background:var(--paper);border-radius:10px;padding:2rem;
  max-width:380px;width:90%;box-shadow:0 8px 30px rgba(0,0,0,0.15);
  position:relative;max-height:90vh;overflow-y:auto;
}
.modal h2{font-family:'Shippori Mincho',serif;font-size:1.3rem;margin-bottom:1.5rem}
.modal-close{
  position:absolute;top:0.8rem;right:1rem;background:none;border:none;
  font-size:1.4rem;cursor:pointer;color:var(--ink);opacity:0.5;
}
.modal-close:hover{opacity:1}
.sett-row{margin-bottom:1.2rem}
.sett-label{font-weight:700;font-size:0.9rem;margin-bottom:0.4rem}
.sett-desc{font-size:0.8rem;color:#888;margin-bottom:0.5rem}
.sett-btns{display:flex;gap:0.5rem}
.sbtn{
  padding:0.4rem 1rem;border:1.5px solid var(--gold);border-radius:3px;
  background:transparent;color:var(--gold);font-weight:700;cursor:pointer;
  transition:all 0.2s;
}
.sbtn.on{background:var(--gold);color:var(--paper)}
.btn-reset{
  width:100%;padding:0.7rem;background:var(--earth);color:var(--paper);
  border:none;border-radius:4px;font-weight:700;cursor:pointer;margin-top:0.5rem;
  font-family:'Zen Kaku Gothic New',sans-serif;
}
.btn-reset:hover{background:#8B4513}
.sett-jlpt{display:flex;gap:0.5rem;flex-wrap:wrap}
.sett-cb{display:flex;align-items:center;gap:0.3rem;cursor:pointer;font-size:0.85rem;font-weight:600}
.sett-cb input{accent-color:var(--vermillion);width:16px;height:16px;cursor:pointer}
.sett-word-ct{font-size:0.8rem;color:var(--moss);margin-top:0.3rem;font-weight:600}
.sett-word-ct.zero{color:var(--earth)}
.sett-divider{border:none;border-top:1px solid rgba(44,36,22,0.1);margin:1rem 0}
.sett-attr{font-size:0.7rem;color:#999;line-height:1.5;margin-top:0.5rem}
.sett-attr a{color:var(--gold)}
.jlpt-badge{display:inline-block;padding:0.1rem 0.4rem;border-radius:3px;font-size:0.65rem;font-weight:700;color:#fff;margin-left:0.4rem;vertical-align:middle}

/* ── Login Page ── */
.login-page{
  display:flex;align-items:center;justify-content:center;min-height:100vh;
  padding:2rem;
}
.login-card{
  text-align:center;background:var(--paper);
  padding:3rem 2.5rem;border-radius:12px;
  box-shadow:0 4px 20px rgba(0,0,0,0.08);
  max-width:360px;width:100%;
}
.login-title{
  font-family:'Shippori Mincho',serif;font-size:3rem;font-weight:800;
  color:var(--ink);margin-bottom:0.2rem;
}
.login-sub{font-size:1rem;color:var(--gold);margin-bottom:0.3rem;font-style:italic;font-family:'Playfair Display',serif}
.login-desc{font-size:0.85rem;color:#888;margin-bottom:2rem}
.btn-google{
  display:inline-flex;align-items:center;justify-content:center;
  padding:0.7rem 1.5rem;border:1.5px solid #ddd;border-radius:6px;
  background:#fff;color:#333;font-weight:600;font-size:0.9rem;
  cursor:pointer;transition:all 0.2s;
  font-family:'Zen Kaku Gothic New',sans-serif;
}
.btn-google:hover{border-color:#aaa;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.login-note{font-size:0.75rem;color:#aaa;margin-top:1.5rem}

/* ── Typewriter cursor ── */
.tw-cursor{
  display:inline-block;
  color:var(--gold);
  font-weight:400;
  font-style:normal;
  animation:twBlink 0.6s step-end infinite;
  margin-left:1px;
}
@keyframes twBlink{
  0%,100%{opacity:1}
  50%{opacity:0}
}
.ginput.typewriter{
  border-color:var(--gold);
  background:rgba(184,134,11,0.04);
}

/* ── Responsive ── */
@media(max-width:500px){
  .app-title{font-size:2.2rem}
  .word-hira{font-size:2rem}
  .nobori{max-width:100%}
  .wheel-svg{width:180px;height:180px}
  .wheel-section{margin-top:-5rem}
  .conj-grid{gap:0.35rem;padding:0.5rem}
  .ginput{font-size:0.8rem;padding:0.35rem 0.25rem}
  .stats{gap:0.8rem}
  .stat-val{font-size:1.1rem}
  .tree-wrap{max-width:160px}
  .nobori-content{padding:0.8rem 0.8rem 4.5rem}
}
